# `splitmart` 프로젝트 – DB 설계

본 문서는 CQRS 기반 이커머스 플랫폼 구축 실습 중 **상품 등록/수정/삭제 기능**을 담당하는 Command 모델의 데이터베이스 테이블 구조를 설명한다.
테이블은 PostgreSQL을 기준으로 설계되었으며, 실습에 필요한 주요 도메인 중심 테이블에 한정하여 정리하였다.

---

## 1. 상품 테이블 (`products`)

상품의 기본 정보를 저장하는 테이블이다. 슬러그, 상태, 판매자 및 브랜드 외래 키를 포함하며, 다양한 관계의 중심 엔티티로 활용된다.

| 컬럼명                | 타입           | 제약 조건                                         | 설명                                  |
| ------------------ | ------------ | --------------------------------------------- | ----------------------------------- |
| id                 | BIGINT       | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | 상품 식별자                              |
| name               | VARCHAR(255) | NOT NULL                                      | 상품명                                 |
| slug               | VARCHAR(255) | UNIQUE, NOT NULL                              | URL용 슬러그                            |
| short\_description | VARCHAR(500) |                                               | 상품 요약 설명                            |
| full\_description  | TEXT         |                                               | 상품 상세 설명 (HTML 가능)                  |
| created\_at        | TIMESTAMP    | DEFAULT CURRENT\_TIMESTAMP                    | 생성일시                                |
| updated\_at        | TIMESTAMP    | DEFAULT CURRENT\_TIMESTAMP                    | 수정일시                                |
| seller\_id         | BIGINT       | FOREIGN KEY → sellers(id)                     | 판매자 참조                              |
| brand\_id          | BIGINT       | FOREIGN KEY → brands(id)                      | 브랜드 참조                              |
| status             | VARCHAR(20)  | NOT NULL                                      | 상품 상태 (예: ACTIVE, OUT\_OF\_STOCK 등) |

---

## 2. 상품 상세 정보 테이블 (`product_details`)

상품에 대한 상세 스펙, 원산지, 보증 정보 등을 저장하며, 상품 테이블과 1:1 관계를 갖는다.

| 컬럼명                 | 타입            | 제약 조건                                         | 설명                              |
| ------------------- | ------------- | --------------------------------------------- | ------------------------------- |
| id                  | BIGINT        | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | 상세 정보 식별자                       |
| product\_id         | BIGINT        | FOREIGN KEY → products(id), ON DELETE CASCADE | 상품 참조                           |
| weight              | DECIMAL(10,2) |                                               | 무게 (kg)                         |
| dimensions          | JSONB         |                                               | 크기 정보 (width, height, depth) 포함 |
| materials           | TEXT          |                                               | 주요 소재 정보                        |
| country\_of\_origin | VARCHAR(100)  |                                               | 원산지                             |
| warranty\_info      | TEXT          |                                               | 품질 보증 정보                        |
| care\_instructions  | TEXT          |                                               | 관리 지침                           |
| additional\_info    | JSONB         |                                               | 추가 정보 (예: 조립 필요 여부 등)           |

---

## 3. 상품 가격 정보 테이블 (`product_prices`)

상품의 가격, 할인 정보, 세금 비율 등을 관리한다. 상품 테이블과 1:1 관계이다.

| 컬럼명         | 타입            | 제약 조건                                         | 설명        |
| ----------- | ------------- | --------------------------------------------- | --------- |
| id          | BIGINT        | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | 가격 정보 식별자 |
| product\_id | BIGINT        | FOREIGN KEY → products(id), ON DELETE CASCADE | 상품 참조     |
| base\_price | DECIMAL(12,2) | NOT NULL                                      | 기본 가격     |
| sale\_price | DECIMAL(12,2) |                                               | 할인 가격     |
| cost\_price | DECIMAL(12,2) |                                               | 원가 (내부용)  |
| currency    | VARCHAR(3)    | DEFAULT 'KRW'                                 | 통화 단위     |
| tax\_rate   | DECIMAL(5,2)  |                                               | 세율 (백분율)  |

---

## 4. 상품-카테고리 매핑 테이블 (`product_categories`)

상품과 카테고리 간의 다대다 관계를 표현하며, 주요 카테고리 여부를 명시할 수 있다.

| 컬럼명          | 타입      | 제약 조건                                           | 설명         |
| ------------ | ------- | ----------------------------------------------- | ---------- |
| id           | BIGINT  | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY   | 매핑 식별자     |
| product\_id  | BIGINT  | FOREIGN KEY → products(id), ON DELETE CASCADE   | 상품 참조      |
| category\_id | BIGINT  | FOREIGN KEY → categories(id), ON DELETE CASCADE | 카테고리 참조    |
| is\_primary  | BOOLEAN | DEFAULT FALSE                                   | 주요 카테고리 여부 |

---

## 5. 상품-태그 매핑 테이블 (`product_tags`)

상품에 태그를 연결하는 다대다 관계 테이블이다. 필터링 및 검색 기능을 지원하기 위한 구조이다.

| 컬럼명         | 타입     | 제약 조건                                         | 설명     |
| ----------- | ------ | --------------------------------------------- | ------ |
| id          | BIGINT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | 매핑 식별자 |
| product\_id | BIGINT | FOREIGN KEY → products(id), ON DELETE CASCADE | 상품 참조  |
| tag\_id     | BIGINT | FOREIGN KEY → tags(id), ON DELETE CASCADE     | 태그 참조  |

---

## 6. 옵션 그룹 테이블 (`product_option_groups`)

상품의 옵션을 그룹별로 구성한다. 예: 색상, 사이즈 등. 상품과 1\:N 관계를 갖는다.

| 컬럼명            | 타입           | 제약 조건                                         | 설명             |
| -------------- | ------------ | --------------------------------------------- | -------------- |
| id             | BIGINT       | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | 옵션 그룹 식별자      |
| product\_id    | BIGINT       | FOREIGN KEY → products(id), ON DELETE CASCADE | 상품 참조          |
| name           | VARCHAR(100) | NOT NULL                                      | 옵션 그룹명 (예: 색상) |
| display\_order | INTEGER      | DEFAULT 0                                     | 표시 순서          |

---

## 7. 옵션 항목 테이블 (`product_options`)

옵션 그룹에 속한 실제 선택 항목을 정의한다. 예: 블랙, XL 등.

| 컬럼명               | 타입            | 제약 조건                                                        | 설명         |
| ----------------- | ------------- | ------------------------------------------------------------ | ---------- |
| id                | BIGINT        | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY                | 옵션 식별자     |
| option\_group\_id | BIGINT        | FOREIGN KEY → product\_option\_groups(id), ON DELETE CASCADE | 옵션 그룹 참조   |
| name              | VARCHAR(100)  | NOT NULL                                                     | 옵션명        |
| additional\_price | DECIMAL(12,2) | DEFAULT 0                                                    | 추가 가격      |
| sku               | VARCHAR(100)  |                                                              | 재고 식별용 SKU |
| stock             | INTEGER       | DEFAULT 0                                                    | 재고 수량      |
| display\_order    | INTEGER       | DEFAULT 0                                                    | 표시 순서      |

---

## 8. 상품 이미지 테이블 (`product_images`)

상품의 대표 이미지 및 옵션별 이미지 등을 저장한다.

| 컬럼명            | 타입           | 제약 조건                                                  | 설명                |
| -------------- | ------------ | ------------------------------------------------------ | ----------------- |
| id             | BIGINT       | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY          | 이미지 식별자           |
| product\_id    | BIGINT       | FOREIGN KEY → products(id), ON DELETE CASCADE          | 상품 참조             |
| url            | VARCHAR(255) | NOT NULL                                               | 이미지 URL           |
| alt\_text      | VARCHAR(255) |                                                        | 이미지 설명 (alt 텍스트)  |
| is\_primary    | BOOLEAN      | DEFAULT FALSE                                          | 대표 이미지 여부         |
| display\_order | INTEGER      | DEFAULT 0                                              | 표시 순서             |
| option\_id     | BIGINT       | FOREIGN KEY → product\_options(id), ON DELETE SET NULL | 옵션과 연결된 이미지 (선택적) |
